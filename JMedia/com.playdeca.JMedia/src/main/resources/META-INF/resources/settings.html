<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title id="pageTitle">JMedia Settings</title>

        <script src="/js/theme-initializer.js"></script>

        <!-- Bulma CSS -->
        <link rel="stylesheet" href="/css/bulma.min.css"/>
        <link rel="stylesheet" href="https://unpkg.com/primeicons@7.0.0/primeicons.css">
        <link rel="stylesheet" href="/css/custom.css"/>
      

        <!-- HTMX -->
        <script src="/js/htmx.min.js"></script>

        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <script>
            document.addEventListener('alpine:init', () => {
                Alpine.store('profile', {
                    currentProfile: null,
                });
            });
        </script>

        <link id="favicon" rel="icon" type="image/x-icon" href="logo.png">
 
    </head>
    <body>

        <audio id="audioPlayer" preload="auto"></audio> 

        <section class="hero is-fullheight">

            <!-- Hero Head (Navbar) -->
            <div class="hero-head">
                <nav class="navbar" role="navigation">
                    <div class="navbar-brand">
                        <a class="navbar-item" href="/index.html"><span class="icon"><i class="pi pi-home"></i></span><strong>JMedia</strong></a>
                        <a role="button" class="navbar-item" id="themeToggle">
                            <i class="pi pi-sun" id="themeIcon"></i>
                        </a>
                        <a role="button" class="navbar-item" id="playerToggle">
                            <i class="pi pi-expand" id="playerIcon"></i>
                        </a>
                        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                            <span aria-hidden="true"></span>
                            <span aria-hidden="true"></span>
                            <span aria-hidden="true"></span>
                        </a>
                        <a role="button" class="navbar-item is-hidden-desktop is-hidden-mobile" id="sidebarToggle">
                            <i class="pi pi-bars"></i>
                        </a>
                    </div>
                    <div id="navMenu" class="navbar-menu">
                        <div class="navbar-start">
                        </div>
                        <div class="navbar-item is-expanded" style="justify-content: center;">
                            <div class="navbar-search-container">
                                <div class="control has-icons-right" style="flex-grow: 1;">
                                    <input class="input is-rounded" type="text" placeholder="Search all songs..." name="search" id="globalSearchInput"
                                           hx-get="/api/music/ui/search-results"
                                           hx-trigger="keyup changed delay:500ms, search"
                                           hx-target="#searchResultsContainer"
                                           hx-swap="innerHTML"
                                           hx-include="[name='search']"
                                           hx-indicator="#loadingRow">
                                    <span class="icon is-small is-right is-clickable" id="clearSearchIcon" style="pointer-events: auto;">
                                        <i class="pi pi-times"></i>
                                    </span>
                                </div>
                                <div id="globalSearchDropdown" class="dropdown-menu" role="menu" style="display: none;">
                                    <div id="globalSearchDropdownLoadingIndicator" class="htmx-indicator has-text-centered py-2">
                                        <i class="pi pi-spin pi-spinner" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <div class="dropdown-content"
                                         id="searchSuggestionsDropdown"
                                         hx-trigger="keyup changed delay:300ms from:#globalSearchInput"
                                         hx-vals="js:{searchQuery: document.getElementById('globalSearchInput').value}"
                                         hx-target="this"
                                         hx-swap="innerHTML"
                                         hx-indicator="#globalSearchDropdownLoadingIndicator">
                                        <!-- Suggestions will be loaded here -->
                                    </div>

                                    <!-- Debug Buttons -->
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-warning is-outlined is-fullwidth is-small" onclick="debugInstallationElements()">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-search"></i></span>
                                                    <span>Debug Elements</span>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-info is-outlined is-fullwidth is-small" onclick="testInstallationAPI()">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-plug"></i></span>
                                                    <span>Test API</span>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-success is-outlined is-fullwidth is-small" onclick="forceUpdateStatus()">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-check"></i></span>
                                                    <span>Force Update Test</span>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <!-- Refresh Status Button -->
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-primary is-outlined is-fullwidth is-small" onclick="refreshInstallationStatus()">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-refresh"></i></span>
                                                    <span>Refresh Installation Status</span>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="navbar-end">
                            <a class="navbar-item" id="openProfileModalBtn">
                                <span class="icon"><i class="pi pi-user"></i></span>
                                <span id="currentProfileName">Loading...</span>
                            </a>

                            <a class="navbar-item" href="/settings.html">
                                <span class="icon"><i class="pi pi-cog"></i></span>
                                <span>Settings</span>
                            </a>
                            <a class="navbar-item" href="/import.html">
                                <span class="icon"><i class="pi pi-download"></i></span>
                                <span>Import</span>
                            </a>
                        </div>
                    </div>
                </nav>
            </div>

            <!-- Hero Body (Main content area) -->
            <div class="hero-body m-0 p-0">
                <div id="mainContent" style="width:100%; overflow-y: auto;">
                    <section class="section">
                        <h1 class="title">Settings</h1>
                        
                        <!-- Tabs Navigation -->
                        <div class="tabs is-boxed is-fullwidth glass-box" id="settingsTabs">
                            <ul>
                                <li class="is-active" data-tab="library-management">
                                    <a>
                                        <span class="icon-text">
                                            <span class="icon"><i class="pi pi-folder-open"></i></span>
                                            <span>Library Management</span>
                                        </span>
                                    </a>
                                </li>
                                <li data-tab="import-installation">
                                    <a>
                                        <span class="icon-text">
                                            <span class="icon"><i class="pi pi-download"></i></span>
                                            <span>Import Installation</span>
                                        </span>
                                    </a>
                                </li>
                                <li data-tab="device-sync">
                                    <a>
                                        <span class="icon-text">
                                            <span class="icon"><i class="pi pi-mobile"></i></span>
                                            <span>Device Sync</span>
                                        </span>
                                    </a>
                                </li>
<li data-tab="playlist-creator">
                                    <a>
                                        <span class="icon-text">
                                            <span class="icon"><i class="pi pi-plus-circle"></i></span>
                                            <span>Playlist Creator</span>
                                        </span>
                                    </a>
                                </li>
                                <li data-tab="logs">
                                    <a>
                                        <span class="icon-text">
                                            <span class="icon"><i class="pi pi-list"></i></span>
                                            <span>Logs</span>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <!-- Tab Content -->
                        <div class="tab-content">
                            <!-- Library Management Tab -->
                            <div id="library-management" class="tab-pane is-active glass-box">
                                <div class="tab-content-inner">

                                        <!-- Run as Service -->
                                        <div class="field switch-field mb-5">
                                            <label class="switch">
                                                <input id="runAsServiceToggle" type="checkbox" name="runAsServiceToggle">
                                                <span class="check"></span>
                                                <span class="control-label">Run as Service</span>
                                            </label>
                                        </div>

                                        <!-- Music Library Section -->
                                        <div class="mb-5">
                                            <h6 class="title is-6 mb-4">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-music"></i></span>
                                                    <span>Music Library</span>
                                                </span>
                                            </h6>
                                            <div class="field">
                                                <label class="label">Music Library Folder</label>
                                                <div class="field has-addons">
                                                    <div class="control">
                                                        <button id="browseMusicFolderBtn" class="button is-small is-warning">
                                                            <span class="icon-text">
                                                                <span class="icon"><i class="pi pi-folder-open"></i></span>
                                                                <span>Browse</span>
                                                            </span>
                                                        </button>
                                                    </div>
                                                    <div class="control is-expanded" >
                                                        <input id="musicLibraryPathInput" style="height: 100%" name="musicLibraryPathInput" class="input" type="text" placeholder="Select music library folder" value="(not set)">
                                                    </div>
                                                    <div class="control">
                                                        <button id="saveMusicLibraryPathBtn" class="button is-small is-success"
                                                                hx-post="/api/settings/music-library-path"
                                                                hx-include="#musicLibraryPathInput"
                                                                hx-swap="none">
                                                            <span class="icon-text">
                                                                <span class="icon"><i class="pi pi-save"></i></span>
                                                                <span>Save Path</span>
                                                            </span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="buttons is-flex-wrap-wrap">
                                                <button id="scanLibrary" class="button is-primary is-small">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-refresh"></i></span>
                                                        <span>Scan Library</span>
                                                    </span>
                                                </button>
                                                <button id="reloadMetadata" class="button is-info is-small">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-sync"></i></span>
                                                        <span>Reload Metadata</span>
                                                    </span>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Video Library Section -->
                                        <div class="mb-5">
                                            <div class="field">
                                                <label class="switch">
                                                    <input id="enableVideoLibraryToggle" type="checkbox" name="enableVideoLibraryToggle">
                                                    <span class="check"></span>
                                                    <span class="control-label">Enable Video Library (BETA)</span>
                                                </label>
                                            </div>

                                            <div id="videoLibraryOptions" class="is-hidden">
                                                <h6 class="title is-6 mb-3">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-video"></i></span>
                                                        <span>Video Library</span>
                                                    </span>
                                                </h6>
                                                <div class="field">
                                                    <label class="label">Video Library Folder</label>
                                                    <div class="field has-addons">
                                                        <div class="control">
                                                            <button id="browseVideoFolderBtn" class="button is-small is-warning">
                                                                <span class="icon-text">
                                                                    <span class="icon"><i class="pi pi-folder-open"></i></span>
                                                                    <span>Browse</span>
                                                                </span>
                                                            </button>
                                                        </div>
                                                        <div class="control is-expanded">
                                                            <input id="videoLibraryPathInput" style="height: 100%" name="videoLibraryPathInput" class="input" type="text" placeholder="Select video library folder" value="(not set)">
                                                        </div>
                                                        <div class="control">
                                                            <button id="saveVideoLibraryPathBtn" class="button is-small is-success"
                                                                    hx-post="/api/settings/video-library-path"
                                                                    hx-include="#videoLibraryPathInput"
                                                                    hx-swap="none">
                                                                <span class="icon-text">
                                                                    <span class="icon"><i class="pi pi-save"></i></span>
                                                                    <span>Save Path</span>
                                                                </span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="buttons is-flex-wrap-wrap">
                                                    <button id="scanVideoLibrary" class="button is-primary is-small"
                                                            hx-post="/api/video/scan"
                                                            hx-trigger="click"
                                                            hx-swap="none">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-refresh"></i></span>
                                                            <span>Scan Video Library</span>
                                                        </span>
                                                    </button>
                                                    <button id="reloadVideoMetadata" class="button is-info is-small"
                                                            hx-post="/api/video/reload-metadata"
                                                            hx-trigger="click"
                                                            hx-swap="none">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-sync"></i></span>
                                                            <span>Reload Metadata</span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Data Management Section -->
                                        <div class="mb-3">
                                            <hr>
                                            <h6 class="title is-6 mb-3">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-database"></i></span>
                                                    <span>Data Management</span>
                                                </span>
                                            </h6>
                                            
                                            <!-- Music Data Management -->
                                            <div class="mb-4">
                                                <p class="has-text-weight-semibold mb-2 is-size-7">Music Library</p>
                                                <div class="buttons is-flex-wrap-wrap">
                                                    <button id="resetLibrary" class="button is-danger is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-undo"></i></span>
                                                            <span>Reset Music</span>
                                                        </span>
                                                    </button>
                                                    <button id="deleteDuplicates" class="button is-danger is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-trash"></i></span>
                                                            <span>Delete Duplicates</span>
                                                        </span>
                                                    </button>
                                                    <button id="clearSongs" class="button is-danger is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-times-circle"></i></span>
                                                            <span>Clear Songs DB</span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <!-- Other Data Management -->
                                            <div class="mb-4">
                                                <p class="has-text-weight-semibold mb-2 is-size-7">Other Data</p>
                                                <div class="buttons is-flex-wrap-wrap">
                                                    <button id="clearPlaybackHistory" hx-post="/api/settings/clearPlaybackHistory" class="button is-danger is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-history"></i></span>
                                                            <span>Clear History</span>
                                                        </span>
                                                    </button>
                                                    <button id="resetVideoDb" class="button is-danger is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-database"></i></span>
                                                            <span>Reset Video DB</span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Update Management Section -->
                                        <div class="mb-3">
                                            <hr>
                                            <h6 class="title is-6 mb-3">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-download"></i></span>
                                                    <span>Update Management</span>
                                                </span>
                                            </h6>
                                            
                                            <div class="field">
                                                <label class="label">Current Version</label>
                                                <div class="control">
                                                    <input type="text" class="input" id="currentVersionInput" value="0.9.0" disabled style="cursor: not-allowed; opacity: 0.7;">
                                                </div>
                                            </div>
                                            
                                            <div class="field">
                                                <label class="switch">
                                                    <input type="checkbox" id="autoUpdateToggle" checked>
                                                    <span class="check"></span>
                                                    <span class="control-label">Auto-check for updates</span>
                                                </label>
                                            </div>
                                            
                                            <div class="buttons is-flex-wrap-wrap">
                                                <button id="checkForUpdatesBtn" class="button is-primary is-small">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-refresh"></i></span>
                                                        <span>Check for Updates</span>
                                                    </span>
                                                </button>
                                                <button id="viewUpdateDialogBtn" class="button is-info is-small">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-external-link"></i></span>
                                                        <span>View Update Info</span>
                                                    </span>
                                                </button>
                                            </div>
                                            
                                            <div id="updateStatus" class="mt-2" style="display: none;">
                                                <!-- Update status will be shown here -->
                                            </div>
                                        </div>
                                </div>
                            </div>

                            <!-- Import Installation Tab -->
                            <div id="import-installation" class="tab-pane glass-box">
                                <div class="tab-content-inner">
                                        <div class="notification is-warning is-light" id="installationRequiredDialog">
                                            <div class="content">
                                                <p class="has-text-weight-semibold">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-exclamation-triangle"></i></span>
                                                        <span>Import features require additional installations.</span>
                                                    </span>
                                                </p>
                                                <p class="mb-3">The following components need to be installed to enable music import functionality:</p>
                                                <ul class="mb-4" id="missingComponentsList">
                                                    <!-- Components will be dynamically added here -->
                                                </ul>
                                                <div class="notification is-info is-light">
                                                    <p class="is-size-7 mb-0">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-info-circle"></i></span>
                                                        <span>Note: On Windows, Chocolatey is installed first, then Python and FFmpeg via Chocolatey, and SpotDL/Whisper via pip (Python).</span>
                                                    </span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Chocolatey Installation -->
                                        <div class="field mb-3">
                                            <div class="level is-mobile">
                                                <div class="level-left">
                                                    <label class="label mb-0">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-box"></i></span>
                                                            <span>Chocolatey</span>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class="level-right">
                                                    <button id="installChocoBtn" class="button is-success is-rounded is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-download"></i></span>
                                                            <span>Install Chocolatey</span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="mt-2" id="chocoProgressContainer" style="display: none;">
                                                <progress id="chocoInstallProgress" class="progress is-small is-info" value="0" max="100">0%</progress>
                                            </div>
                                            <p id="chocoStatus" class="help is-size-7 mt-2">Not installed</p>
                                        </div>

                                        <!-- Python Installation -->
                                        <div class="field mb-3">
                                            <div class="level is-mobile">
                                                <div class="level-left">
                                                    <label class="label mb-0">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-code"></i></span>
                                                            <span>Python</span>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class="level-right">
                                                    <button id="installPythonBtn" class="button is-success is-rounded is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-download"></i></span>
                                                            <span>Install Python</span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="mt-2" id="pythonProgressContainer" style="display: none;">
                                                <progress id="pythonInstallProgress" class="progress is-small is-info" value="0" max="100">0%</progress>
                                            </div>
                                            <p id="pythonStatus" class="help is-size-7 mt-2">Not installed</p>
                                        </div>

                                        <!-- FFmpeg Installation -->
                                        <div class="field mb-3">
                                            <div class="level is-mobile">
                                                <div class="level-left">
                                                    <label class="label mb-0">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-video"></i></span>
                                                            <span>FFmpeg</span>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class="level-right">
                                                    <button id="installFfmpegBtn" class="button is-success is-rounded is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-download"></i></span>
                                                            <span>Install FFmpeg</span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="mt-2" id="ffmpegProgressContainer" style="display: none;">
                                                <progress id="ffmpegInstallProgress" class="progress is-small is-info" value="0" max="100">0%</progress>
                                            </div>
                                            <p id="ffmpegStatus" class="help is-size-7 mt-2">Not installed</p>
                                        </div>

                                        <!-- SpotDL Installation -->
                                        <div class="field mb-3">
                                            <div class="level is-mobile">
                                                <div class="level-left">
                                                    <label class="label mb-0">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-music"></i></span>
                                                            <span>SpotDL</span>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class="level-right">
                                                    <button id="installSpotdlBtn" class="button is-success is-rounded is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-download"></i></span>
                                                            <span>Install SpotDL</span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="mt-2" id="spotdlProgressContainer" style="display: none;">
                                                <progress id="spotdlInstallProgress" class="progress is-small is-info" value="0" max="100">0%</progress>
                                            </div>
                                            <p id="spotdlStatus" class="help is-size-7 mt-2">Not installed</p>
                                        </div>

                                        <!-- Whisper Installation -->
                                        <div class="field mb-3">
                                            <div class="level is-mobile">
                                                <div class="level-left">
                                                    <label class="label mb-0">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-microphone"></i></span>
                                                            <span>Whisper</span>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class="level-right">
                                                    <button id="installWhisperBtn" class="button is-success is-rounded is-small">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-download"></i></span>
                                                            <span>Install Whisper</span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="mt-2" id="whisperProgressContainer" style="display: none;">
                                                <progress id="whisperInstallProgress" class="progress is-small is-info" value="0" max="100">0%</progress>
                                            </div>
                                            <p id="whisperStatus" class="help is-size-7 mt-2">Not installed</p>
                                        </div>

                                        <!-- Import Settings Section -->
                                        <hr>
                                        <h6 class="title is-6 mb-4">
                                            <span class="icon-text">
                                                <span class="icon"><i class="pi pi-cog"></i></span>
                                                <span>Import Settings</span>
                                            </span>
                                        </h6>

                                        <div class="field">
                                            <label class="label" for="outputFormat">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-file"></i></span>
                                                    <span>Output Format</span>
                                                </span>
                                            </label>
                                            <div class="control">
                                                <div class="select is-fullwidth">
                                                    <select id="outputFormat">
                                                        <option value="mp3">MP3</option>
                                                        <option value="flac">FLAC</option>
                                                        <option value="ogg">OGG</option>
                                                        <option value="opus">OPUS</option>
                                                        <option value="m4a">M4A</option>
                                                        <option value="wav">WAV</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column">
                                                <div class="field">
                                                    <label class="label" for="downloadThreads">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-download"></i></span>
                                                            <span>Download Threads</span>
                                                        </span>
                                                    </label>
                                                    <div class="control">
                                                        <input class="input" type="number" id="downloadThreads" value="4" min="1">
                                                    </div>
                                                </div> 
                                            </div>
                                            <div class="column">
                                                <div class="field">
                                                    <label class="label" for="searchThreads">
                                                        <span class="icon-text">
                                                            <span class="icon"><i class="pi pi-search"></i></span>
                                                            <span>Search Threads</span>
                                                        </span>
                                                    </label>
                                                    <div class="control">
                                                        <input class="input" type="number" id="searchThreads" value="4" min="1">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="buttons mt-3">
                                            <button id="saveImportSettingsBtn" class="button is-success is-fullwidth">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-save"></i></span>
                                                    <span>Save Settings</span>
                                                </span>
                                            </button>
                                        </div>
                                </div>
                            </div>

                            <!-- Device Sync Tab -->
                            <div id="device-sync" class="tab-pane glass-box">
                                <div class="tab-content-inner">
                                        
                                        <!-- QR Code Section -->
                                        <div class="mb-5">
                                            <h6 class="title is-6 mb-4">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-qrcode"></i></span>
                                                    <span>Connect New Device</span>
                                                </span>
                                            </h6>
                                            
                                            <div class="has-text-centered mb-4" id="qrCodeContainer">
                                                <div class="notification is-info is-light">
                                                    <p class="is-size-7">Click "Generate QR Code" to create a connection code for your mobile device</p>
                                                </div>
                                            </div>
                                            
                                            <div class="buttons is-centered">
                                                <button id="generateQrCodeBtn" class="button is-primary is-small">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-qrcode"></i></span>
                                                        <span>Generate QR Code</span>
                                                    </span>
                                                </button>
                                                <button id="refreshQrCodeBtn" class="button is-info is-small" style="display: none;">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-refresh"></i></span>
                                                        <span>Refresh</span>
                                                    </span>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Active Sessions Section -->
                                        <div class="mb-5">
                                            <h6 class="title is-6 mb-4">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-users"></i></span>
                                                    <span>Connected Devices</span>
                                                </span>
                                            </h6>
                                            
                                            <div id="deviceSessionsList">
                                                <!-- Device sessions will be populated here -->
                                                <div class="notification is-warning is-light">
                                                    <p class="is-size-7">No devices currently connected</p>
                                                </div>
                                            </div>
                                            
                                            <div class="buttons mt-3">
                                                <button id="refreshSessionsBtn" class="button is-info is-small">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-refresh"></i></span>
                                                        <span>Refresh</span>
                                                    </span>
                                                </button>
                                                <button id="cleanupExpiredBtn" class="button is-warning is-small">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-broom"></i></span>
                                                        <span>Cleanup Expired</span>
                                                    </span>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Sync Settings Section -->
                                        <div class="mb-3">
                                            <hr>
                                            <h6 class="title is-6 mb-3">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="pi pi-cog"></i></span>
                                                    <span>Sync Settings</span>
                                                </span>
                                            </h6>
                                            
                                            <div class="field">
                                                <label class="switch">
                                                    <input id="syncMusicToggle" type="checkbox" checked>
                                                    <span class="check"></span>
                                                    <span class="control-label">Sync Music Library</span>
                                                </label>
                                            </div>
                                            
                                            <div class="field">
                                                <label class="switch">
                                                    <input id="syncVideosToggle" type="checkbox">
                                                    <span class="check"></span>
                                                    <span class="control-label">Sync Videos/Movies</span>
                                                </label>
                                            </div>
                                            
                                            <div class="field">
                                                <label class="switch">
                                                    <input id="syncPlaylistsToggle" type="checkbox" checked>
                                                    <span class="check"></span>
                                                    <span class="control-label">Sync Playlists</span>
                                                </label>
                                            </div>
                                        </div>

                                </div>
                            </div>

<!-- Playlist Creator Tab -->
                            <div id="playlist-creator" class="tab-pane glass-box">
                                <div class="tab-content-inner">
                                    <h6 class="title is-6 mb-4">
                                        <span class="icon-text">
                                            <span class="icon"><i class="pi pi-plus-circle"></i></span>
                                            <span>Create Playlist from Text</span>
                                        </span>
                                    </h6>

                                    <!-- Playlist Information -->
                                    <div class="field">
                                        <label class="label">Playlist Name</label>
                                        <div class="control">
                                            <input id="playlistNameInput" class="input" type="text" placeholder="Enter playlist name...">
                                        </div>
                                    </div>

                                    <div class="field">
                                        <label class="label">Description (Optional)</label>
                                        <div class="control">
                                            <textarea id="playlistDescriptionInput" class="textarea" rows="2" placeholder="Enter playlist description..."></textarea>
                                        </div>
                                    </div>

                                    <!-- Text Input -->
                                    <div class="field">
                                        <label class="label">Song List</label>
                                        <div class="control">
                                            <textarea id="songListTextarea" class="textarea" rows="10" placeholder="Paste your song list here...

Supported formats:
 Song Name, Album, Artist
 Song Name - Artist
 Artist - Song Name

Example:
Bohemian Rhapsody, A Night at the Opera, Queen
Stairway to Heaven - Led Zeppelin
Hotel California - Eagles"></textarea>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="buttons">
                                        <button id="createPlaylistBtn" class="button is-primary">
                                            <span class="icon-text">
                                                <span class="icon"><i class="pi pi-plus"></i></span>
                                                <span>Create Playlist</span>
                                            </span>
                                        </button>
                                        <button id="clearPlaylistFormBtn" class="button is-light">
                                            <span class="icon-text">
                                                <span class="icon"><i class="pi pi-times"></i></span>
                                                <span>Clear Form</span>
                                            </span>
                                        </button>
                                    </div>

                                    <!-- Results Section -->
                                    <div id="playlistResults" class="mt-4" style="display: none;">
                                        <div class="notification">
                                            <p id="resultsMessage" class="mb-2"></p>
                                            
                                            <div id="unmatchedSection" style="display: none;">
                                                <p class="has-text-weight-semibold mb-2">Unmatched Songs:</p>
                                                <div id="unmatchedList" class="content" style="max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.05); padding: 10px; border-radius: 4px;">
                                                    <!-- Unmatched songs will be listed here -->
                                                </div>
                                            </div>

                                            <div class="buttons mt-3">
                                                <button id="viewPlaylistBtn" class="button is-info is-small">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="pi pi-eye"></i></span>
                                                        <span>View Playlist</span>
                                                    </span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Logs Tab -->
                            <div id="logs" class="tab-pane glass-box">
                                <div class="tab-content-inner">
                                    <div style="max-height: 200px; overflow-y: auto;" id="logsPanel">
                                        <!-- JS will populate logs here -->
                                    </div>
                                    <div class="buttons mt-3">
                                        <button id="clearLogs" class="button is-danger is-small">
                                            <span class="icon-text">
                                                <span class="icon"><i class="pi pi-trash"></i></span>
                                                <span>Clear Logs</span>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div> 

            <!-- Hero Foot (Music Bar) -->
            <div class="hero-foot card glass-box mx-3 mb-3">
                <nav class="level is-mobile">

                    <!-- LEFT: Song Info -->
                    <div class="level-left is-hidden-mobile">
                        <div class="level-item">
                            <div class="image-container mr-3">
                                <figure class="image is-96x96">
                                    <img id="songCoverImage" src="/logo.png" alt="Song Cover">
                                </figure>
                                <button id="expandImageBtn">
                                    <span class="icon is-small"><i class="pi pi-expand"></i></span>
                                </button>
                            </div>
                            <div>
                                <p id="songTitle" class="has-text-white has-text-weight-semibold is-size-6">Loading...</p>
                                <p id="songArtist" class="has-text-success is-size-7">Unknown Artist</p>
                            </div>
                        </div>
                    </div>

                    <!-- CENTER: Controls + Progress -->
                    <div class="level-item has-text-centered is-flex is-flex-direction-column is-align-items-center" style="width: 100%; flex-grow: 1; flex-shrink: 1;">
                        <!-- Playback buttons -->
                        <div class="buttons are-medium mb-2">
                            <button id="shuffleBtn" title="Shuffle"><i id="shuffleIcon" class="pi pi-sort-alt" style="font-size: 1.5rem;"></i></button>
                            <button id="prevBtn" title="Previous"><i class="pi pi-step-backward" style="font-size: 1.5rem;"></i></button>
                            <button id="playPauseBtn" class="button is-rounded is-large" title="Play/Pause"><i id="playPauseIcon" class="pi pi-play"></i></button>
                            <button id="nextBtn" title="Next"><i id="nextIcon" class="pi pi-step-forward" style="font-size: 1.5rem;"></i></button>
                            <button id="repeatBtn" title="Repeat"><i id="repeatIcon" class="pi pi-refresh" style="font-size: 1.5rem;"></i></button>
                        </div>

                        <!-- Progress bar -->
                        <div class="is-flex is-align-items-center is-justify-content-center" style="width: 100%;">
                            <span id="currentTime" class="has-text-success has-text-weight-semibold is-size-6 mr-2">0:00</span>
                            <input type="range" min="0" max="100" value="0"
                                   style="width:100%"
                                   name="seconds" id="playbackProgressBar"/>
                            <span id="totalTime" class="has-text-success has-text-weight-semibold is-size-6 ml-2">0:00</span>
                        </div>

                        <!-- Song Info for mobile -->
                        <div class="is-hidden-desktop mt-2" style="width: 100%;">
                            <div style="overflow: hidden;">
                                <p id="songTitleMobile" class="has-text-white has-text-weight-semibold is-size-6 marquee">Loading...</p>
                            </div>
                            <div style="overflow: hidden;">
                                <p id="songArtistMobile" class="has-text-success is-size-7 marquee">Unknown Artist</p>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT: Volume -->
                    <div class="level-right is-hidden-mobile">
                        <div class="level-item">
                            <div class="is-flex is-align-items-center">
                               <i class="pi pi-volume-up mr-2"></i>
                                 <input style="width: 80%" type="range" min="0" max="100" value="80" name="level" id="volumeProgressBar"/>
                            </div>
                        </div>
                    </div> 
                </nav>
            </div>

        </section>

        <!-- Toast Container -->
        <div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 10000;"></div>

        <script src="/js/toast.js"></script>
        <script src="/js/musicBar.js"></script>
        <script src="/js/mediaSession.js"></script>
        <script src="/js/settings.js"></script>
        <script src="/js/playlist-creator.js"></script>
        <script src="/js/video-settings.js"></script>
        <script src="/js/navbar.js"></script>
        <script src="/js/profileManager.js"></script>

        <!-- Tab functionality script -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const tabButtons = document.querySelectorAll('#settingsTabs li');
                const tabPanes = document.querySelectorAll('.tab-pane');

                tabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const targetTab = this.getAttribute('data-tab');
                        
                        // Remove active class from all buttons and panes
                        tabButtons.forEach(btn => btn.classList.remove('is-active'));
                        tabPanes.forEach(pane => pane.classList.remove('is-active'));
                        
                        // Add active class to clicked button and corresponding pane
                        this.classList.add('is-active');
                        const targetPane = document.getElementById(targetTab);
                        if (targetPane) {
                            targetPane.classList.add('is-active');
                        }
                    });
                });
            });
        </script>

        <script>
            // Initialize globalActiveProfileId before deviceSync.js
            window.globalActiveProfileId = localStorage.getItem('activeProfileId') || '1'; // Default to '1' (Main profile) if not set
        </script>
        <script src="/js/deviceSync.js"></script>

        <script>
                                                        // Toast Notification System now handled by unified toast.js library
        </script>

        <script>
            // Load installation status after DOM is fully loaded and globalActiveProfileId is initialized
            document.addEventListener('DOMContentLoaded', () => {
                // Load installation status once after DOM is ready
                if (typeof loadInstallationStatus === 'function') {
                    setTimeout(() => {
                        loadInstallationStatus();
                    }, 100);
                }
            });

            // Listen for profile switches from profileManager.js
            document.body.addEventListener('profileSwitched', (event) => {
                window.globalActiveProfileId = localStorage.getItem('activeProfileId');
                console.log('Profile switched event received. New globalActiveProfileId:', globalActiveProfileId);
                // Trigger a full page reload or update all relevant HTMX components
                // For simplicity and full refresh of profile-specific data, a reload is best here.
                location.reload();
            });

            // Set dynamic URLs for HTMX elements that need profileId
            function updateHmxUrls() {
                const searchSuggestionsDropdown = document.getElementById('searchSuggestionsDropdown');
                if (searchSuggestionsDropdown) {
                    searchSuggestionsDropdown.setAttribute('hx-post', `/api/music/ui/search-suggestions/${globalActiveProfileId}`);
                }
            }

            // Update URLs initially and when profile switches
            updateHmxUrls();
            document.body.addEventListener('profileSwitched', updateHmxUrls);

            // HTMX request interception to inject profileId into URLs
            document.body.addEventListener('htmx:beforeRequest', function (event) {
                let targetUrl = event.detail.path;

                // ADD THIS CHECK: Ensure targetUrl is a string before proceeding
                if (typeof targetUrl !== 'string' || !targetUrl) {
                    return; // Exit the function if targetUrl is invalid
                }

                let newUrl = targetUrl; // Initialize newUrl with targetUrl
                const currentProfileId = globalActiveProfileId; // Get the currently active profile ID

                // Skip profile-related API calls that handle profile creation/deletion/switching directly
                // These already include the necessary profile IDs or operate globally.
                if (targetUrl.startsWith('/api/profiles')) {
                    // For example, /api/profiles (GET all), /api/profiles/{id} (DELETE), /api/profiles (POST create)
                    // /api/profiles/current, /api/profiles/switch/{id} are handled by profileManager.js or don't need globalActiveProfileId injected here.
                    return;
                }

                // All other API calls related to music or settings that need profileId
                if (targetUrl.startsWith('/api/music/') || targetUrl.startsWith('/api/settings/')) {
                    const parts = targetUrl.split('/');
                    const module = parts[2]; // 'music' or 'settings'

                    if (module === 'music') {
                        const subModule = parts[3]; // e.g., 'ui', 'playback', 'queue', 'playlists'

                        if (subModule === 'ui') {
                            // Pattern: /api/music/ui/{profileId}/...
                            // Examples: /api/music/ui/playlists-fragment, /api/music/ui/tbody/{profileId}/0, /api/music/ui/search-suggestions/{profileId}
                            // Special case for search-suggestions: /api/music/ui/search-suggestions -> /api/music/ui/search-suggestions/{profileId}
                            if (parts[4] === 'search-suggestions') {
                                newUrl = `/api/music/ui/search-suggestions/${currentProfileId}`;
                            } else if (parts[4] === 'tbody' && parts[5] === '{playlistId}') {
                                // Special case for tbody: /api/music/ui/tbody/{playlistId} -> /api/music/ui/tbody/{currentProfileId}
                                newUrl = `/api/music/ui/tbody/${currentProfileId}`;
                            } else if (parts[4] === 'playlists-fragment' && parts[5] === '{profileId}') {
                                // Special case for playlists-fragment: /api/music/ui/playlists-fragment/{profileId} -> /api/music/ui/playlists-fragment/{currentProfileId}
                                newUrl = `/api/music/ui/playlists-fragment/${currentProfileId}`;
                            } else if (parts[4] === 'playlist-view' && parts[5] === '{profileId}') {
                                // Special case for playlist-view: /api/music/ui/playlist-view/{profileId} -> /api/music/ui/playlist-view/{currentProfileId}
                                newUrl = `/api/music/ui/playlist-view/${currentProfileId}`;
                            } else if (parts[4] === 'queue-fragment' && parts[5] === '{profileId}') {
                                // Special case for queue-fragment: /api/music/ui/queue-fragment/{profileId} -> /api/music/ui/queue-fragment/{currentProfileId}
                                newUrl = `/api/music/ui/queue-fragment/${currentProfileId}`;
                            } else if (parts[4] === 'add-to-playlist-dialog' && parts[5] === '{profileId}') {
                                // Special case for add-to-playlist-dialog: /api/music/ui/add-to-playlist-dialog/{profileId} -> /api/music/ui/add-to-playlist-dialog/${currentProfileId}
                                newUrl = `/api/music/ui/add-to-playlist-dialog/${currentProfileId}`;
                            } else if (parts[4] !== currentProfileId) { // Check if profileId is NOT already correctly placed
                                newUrl = `/api/music/ui/${currentProfileId}` + targetUrl.substring('/api/music/ui'.length);
                            }
                        } else if (subModule === 'playback') {
                            // Pattern: /api/music/playback/{action}/{profileId}/{id?}
                            // Examples: /api/music/playback/queue-all/0, /api/music/playback/select/123, /api/music/playback/toggle
                            const action = parts[4];
                            if (action === 'queue-all' || action === 'select') {
                                // For /api/music/playback/queue-all/{playlistId}, /api/music/playback/select/{songId}
                                // Needs to become /api/music/playback/{action}/{profileId}/{id}
                                newUrl = `/api/music/playback/${action}/${currentProfileId}/${parts[5]}`;
                            } else if (action === 'volume' || action === 'position') {
                                // For /api/music/playback/volume/{level}, /api/music/playback/position/{seconds}
                                // Needs to become /api/music/playback/{action}/{profileId}/{value}
                                newUrl = `/api/music/playback/${action}/${currentProfileId}/${parts[5]}`;
                            } else {
                                // For actions like /api/music/playback/toggle, /api/music/playback/play, /api/music/playback/next, etc.
                                // Needs to become /api/music/playback/{action}/{profileId}
                                if (parts.length < 5 || parts[5] !== currentProfileId) { // If profileId is not appended
                                    newUrl = `${targetUrl}/${currentProfileId}`;
                                }
                            }
                        } else if (subModule === 'queue') {
                            // Pattern: /api/music/queue/{profileId}/{action}/{id?}
                            // Examples: /api/music/queue/add/{songId}, /api/music/queue/skip-to/{index}, /api/music/queue/clear
                            const action = parts[4];
                            if (action === 'add' || action === 'skip-to' || action === 'remove') {
                                // /api/music/queue/{action}/{songId/index} -> /api/music/queue/{action}/{profileId}/{songId/index}
                                newUrl = `/api/music/queue/${action}/${currentProfileId}/${parts[5]}`;
                            } else if (action === 'clear') {
                                // /api/music/queue/clear -> /api/music/queue/clear/{profileId}
                                newUrl = `/api/music/queue/clear/${currentProfileId}`;
                            } else if (parts.length === 4) { // This is likely /api/music/queue (GET current queue for profile)
                                newUrl = `/api/music/queue/${currentProfileId}`;
                            }
                        } else if (subModule === 'playlists') {
                            // Pattern: /api/music/playlists/{playlistId}/songs/{songId}/toggle/{profileId}
                            // Only handles the specific toggle case where profileId is at the end.
                            // Other playlist APIs (create, delete, get playlists themselves) might be global or handled differently.
                            if (parts.length >= 7 && parts[6] === 'toggle') { // Check if it's the toggle action
                                if (parts.length < 8 || parts[7] !== currentProfileId) { // Check if profileId is not appended
                                    newUrl = `${targetUrl}/${currentProfileId}`;
                                }
                            }
                        }
                    } else if (module === 'settings') {
                        // Handle various settings endpoints that need profileId
                        const settingPath = parts[3];
                        if (settingPath === 'clearPlaybackHistory') {
                            // Pattern: /api/settings/clearPlaybackHistory/{profileId}
                            if (parts.length < 5 || parts[4] !== currentProfileId) { // If profileId is not appended
                                newUrl = `${targetUrl}/${currentProfileId}`;
                            }
                        } else if (settingPath === 'music-library-path' || settingPath === 'video-library-path') {
                            // Pattern: /api/settings/music-library-path or /api/settings/video-library-path
                            // These need to become /api/settings/{settingPath}/{profileId}
                            if (parts.length < 5 || parts[4] !== currentProfileId) { // If profileId is not appended
                                newUrl = `${targetUrl}/${currentProfileId}`;
                            }
                        }
                    }
                }

                if (newUrl !== targetUrl) {
                    event.detail.path = newUrl;
                    console.log('HTMX Request URL modified to:', event.detail.path);
                }
            });

            document.addEventListener('DOMContentLoaded', async () => {
                // Card visibility logic removed - both cards now always visible
                // const importSettingsCardColumn = document.getElementById('importSettingsCardColumn');
                // const importInstallationCardColumn = document.getElementById('importInstallationCardColumn');
                // 
                // if (importSettingsCardColumn && importInstallationCardColumn) {
                //     try {
                //         const response = await fetch(`/api/settings/${globalActiveProfileId}/import-capability`);
                //         const data = await response.json();
                //         if (response.ok) {
                //             if (data.data === true) {
                //                 // Show settings card, hide installation card
                //                 importSettingsCardColumn.classList.remove('is-hidden');
                //                 importInstallationCardColumn.classList.add('is-hidden');
                //             } else {
                //                 // Show installation card, hide settings card
                //                 importInstallationCardColumn.classList.remove('is-hidden');
                //                 importSettingsCardColumn.classList.add('is-hidden');
                //         }
                //         }
                //     } catch (error) {
                //         console.error('Failed to fetch import capability status:', error);
                //         // Show installation card by default on error
                //         importInstallationCardColumn.classList.remove('is-hidden');
                //         importSettingsCardColumn.classList.add('is-hidden');
                //     }
                // }



                // --- Start of copied global search logic ---
                const globalSearchInput = document.querySelector('input[name="search"]');
                const globalSearchDropdown = document.getElementById('globalSearchDropdown');

                function showDropdown() {
                    if (globalSearchInput.value.trim() !== '' && globalSearchDropdown.querySelector('.dropdown-item, .htmx-indicator')) {
                        globalSearchDropdown.style.display = 'block';
                    } else {
                        globalSearchDropdown.style.display = 'none';
                    }
                }

                function hideDropdown() {
                    setTimeout(() => {
                        if (!globalSearchInput.matches(':focus')) {
                            globalSearchDropdown.style.display = 'none';
                        }
                    }, 100);
                }

                if (globalSearchInput && globalSearchDropdown) {
                    globalSearchInput.addEventListener('focus', showDropdown);
                    globalSearchInput.addEventListener('keyup', showDropdown);
                    globalSearchInput.addEventListener('blur', hideDropdown);

                    globalSearchDropdown.addEventListener('mousedown', (event) => {
                        event.preventDefault();
                    });
                }

                document.body.addEventListener('click', function (event) {
                    if (event.target.closest('#clearSearchIcon')) {
                        handleClearGlobalSearch();
                    }
                });

                function handleClearGlobalSearch() {
                    const globalSearchInput = document.querySelector('input[name="search"]');
                    const globalSearchDropdown = document.getElementById('globalSearchDropdown');

                    if (globalSearchInput) {
                        globalSearchInput.value = '';
                        if (globalSearchDropdown) {
                            globalSearchDropdown.style.display = 'none';
                        }
                    }
                }

                document.body.addEventListener('htmx:afterSwap', function (event) {
                    if (event.detail.target.closest('#globalSearchDropdown .dropdown-content')) {
                        showDropdown();
                    }
                });

                // Handle incoming search query from other pages (if any)
                const urlParams = new URLSearchParams(window.location.search);
                const searchQuery = urlParams.get('q');
                if (searchQuery && globalSearchInput) {
                    globalSearchInput.value = decodeURIComponent(searchQuery);
                    htmx.trigger(globalSearchInput, 'search');
                    history.replaceState(null, '', window.location.pathname);
                }
                // --- End of copied global search logic ---
            });
        </script>

        <!-- Run as Service Info Modal -->
        <div id="runAsServiceModal" class="modal">
            <div class="modal-background"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">
                        <span class="icon-text">
                            <span class="icon"><i class="pi pi-info-circle"></i></span>
                            <span>Run as Service Information</span>
                        </span>
                    </p>
                    <button class="delete" aria-label="close"></button>
                </header>
                <section class="modal-card-body">
                    <div class="content">
                        <p>Enabling "Run as Service" allows this application to act as a music server, enabling other devices on the network (or with a connection to this device) to stream music from it.</p>
                        
                        <div class="notification is-info is-light">
                            <strong>Key Features:</strong>
                            <ul>
                                <li>Stream music to other devices on your network</li>
                                <li>Application continues running in background</li>
                                <li>Accessible via system tray icon</li>
                            </ul>
                        </div>
                        
                        <div class="notification is-warning is-light">
                            <strong>Important Notes:</strong>
                            <ul>
                                <li>Application will not auto-start on system boot</li>
                                <li>You must launch the application manually</li>
                                <li>Close via tray icon when you want to shut down</li>
                            </ul>
                        </div>
                    </div>
                </section>
                <footer class="modal-card-foot is-flex is-justify-content-center">
                    <button class="button is-success">
                        <span class="icon-text">
                            <span class="icon"><i class="pi pi-check"></i></span>
                            <span>Got it!</span>
                        </span>
                    </button>
                </footer>
            </div>
        </div>

        <!-- Profile Management Modal -->
        <div id="profileModal" class="modal">
            <div class="modal-background" onclick="document.getElementById('profileModal').classList.remove('is-active');"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">
                        <span class="icon-text">
                            <span class="icon"><i class="pi pi-user"></i></span>
                            <span>Manage Profiles</span>
                        </span>
                    </p>
                    <button class="delete" aria-label="close" onclick="document.getElementById('profileModal').classList.remove('is-active');"></button>
                </header>
                <section class="modal-card-body">
                    <div class="content">
                        <div class="notification is-info is-light">
                            <h5 class="title is-5 mb-2">
                                <span class="icon-text">
                                    <span class="icon"><i class="pi pi-user-circle"></i></span>
                                    <span>Current Profile: <span id="modalCurrentProfileName">Loading...</span></span>
                                </span>
                            </h5>
                        </div>
                        
                        <h6 class="title is-6 mb-4">
                            <span class="icon-text">
                                <span class="icon"><i class="pi pi-users"></i></span>
                                <span>All Profiles</span>
                            </span>
                        </h6>
                        
                        <div class="field is-grouped is-grouped-multiline is-justify-content-center" id="profileList">
                            <!-- Profiles will be dynamically loaded here as circular buttons -->
                        </div>
                        
                        <hr>
                        
                        <div class="field">
                            <label class="label">
                                <span class="icon-text">
                                    <span class="icon"><i class="pi pi-plus-circle"></i></span>
                                    <span>Create New Profile</span>
                                </span>
                            </label>
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    <input class="input" type="text" id="newProfileNameInput" placeholder="Enter profile name...">
                                </div>
                                <div class="control">
                                    <button class="button is-info" id="createProfileBtn">
                                        <span class="icon-text">
                                            <span class="icon"><i class="pi pi-plus"></i></span>
                                            <span>Create</span>
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification is-warning is-light">
                            <p class="has-text-weight-semibold mb-2">
                                <span class="icon-text">
                                    <span class="icon"><i class="pi pi-exclamation-triangle"></i></span>
                                    <span>Danger Zone</span>
                                </span>
                            </p>
                            <p class="is-size-7">Deleting a profile will permanently remove all associated data including playlists, playback history, and settings.</p>
                        </div>
                        
                        <button class="button is-danger is-fullwidth" id="deleteCurrentProfileBtn">
                            <span class="icon-text">
                                <span class="icon"><i class="pi pi-trash"></i></span>
                                <span>Delete Current Profile</span>
                            </span>
                        </button>
                    </div>
                </section>
                <footer class="modal-card-foot glass-modal-footer">
                    <button class="button" onclick="document.getElementById('profileModal').classList.remove('is-active');">
                        <span class="icon-text">
                            <span class="icon"><i class="pi pi-times"></i></span>
                            <span>Close</span>
                        </span>
                    </button>
                </footer>
            </div>
        </div>

    </body>
</html>

 <!-- Installation Progress Dialog -->
<div id="installDialog" class="modal">
    <div class="modal-background"></div>
            <div class="modal-card glass-modal">
                <header class="modal-card-head glass-modal-header">
            <p class="modal-card-title">
                <span class="icon-text">
                    <span class="icon"><i class="pi pi-download"></i></span>
                    <span>Installing Requirements</span>
                </span>
            </p>
            <button class="delete" aria-label="close" id="closeInstallDialog"></button>
                </header>
                <section class="modal-card-body glass-modal-body">
                    <div class="content">
                <div class="notification is-info is-light mb-4">
                    <p class="has-text-weight-semibold">
                        <span class="icon-text">
                            <span class="icon"><i class="pi pi-info-circle"></i></span>
                            <span>Installing Components</span>
                        </span>
                    </p>
                    <p class="is-size-7 mb-0">Installing Python, FFmpeg, SpotDL, and Whisper...</p>
                </div>

                <div class="field">
                    <label class="label">
                        <span class="icon-text">
                            <span class="icon"><i class="pi pi-terminal"></i></span>
                            <span>Installation Output</span>
                        </span>
                    </label>
                    <div class="control">
                        <div id="installOutput" class="textarea has-background-black has-text-success" rows="15" readonly>
                            Starting installation...
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="label">
                        <span class="icon-text">
                            <span class="icon"><i class="pi pi-spinner"></i></span>
                            <span>Progress</span>
                        </span>
                    </label>
                    <div class="control">
                        <progress id="installProgress" class="progress is-small is-info" value="0" max="100">0%</progress>
                        <p class="has-text-centered is-size-7 mt-1" id="installProgressText">0% Complete</p>
                    </div>
                </div>
            </div>
        </section>
        <footer class="modal-card-foot">
            <button class="button is-danger" id="cancelInstallBtn">
                <span class="icon-text">
                    <span class="icon"><i class="pi pi-times-circle"></i></span>
                    <span>Cancel Installation</span>
                </span>
            </button>
        </footer>
    </div>
</div>