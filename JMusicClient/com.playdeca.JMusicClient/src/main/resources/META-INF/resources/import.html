<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title id="pageTitle">Spotdl/Yt-dlp Interface</title>
        <script src="/js/theme-initializer.js"></script>
        <link rel="stylesheet" href="/css/bulma.min.css"/>
        <link rel="stylesheet" href="https://unpkg.com/primeicons@7.0.0/primeicons.css">
        <link rel="stylesheet" href="/css/custom.css"/>
        <link rel="stylesheet" href="/css/playback-bar.css"/>
        <script src="/js/htmx.min.js"></script>
        <link id="favicon" rel="icon" type="image/x-icon" href="logo.png">
    </head>
    <body>
        <audio id="audioPlayer" preload="metadata"></audio>

        <section class="hero is-fullheight">
            <div class="hero-head">
                <nav class="navbar" role="navigation">
                    <div class="navbar-brand">
                        <a class="navbar-item" href="/index.html"><strong>JMusic</strong></a>
                        <a role="button" class="navbar-item" id="themeToggle">
                            <i class="pi pi-sun" id="themeIcon"></i>
                        </a>
                        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                            <span aria-hidden="true"></span>
                            <span aria-hidden="true"></span>
                            <span aria-hidden="true"></span>
                        </a>
                    </div>
                    <div id="navMenu" class="navbar-menu">
                        <div class="navbar-end">
                            <a class="navbar-item" href="/index.html">Home</a> 
                            <a class="navbar-item" href="/settings.html">Settings</a>
                            <a class="navbar-item" href="/import.html">Import</a>
                        </div>
                    </div>
                </nav>
            </div>

            <div class="hero-body">
                <div class="container">
                    <h1 class="title has-text-white">Import Interface</h1>
                    <div id="externalAppWarning" class="notification is-info">
                        <button class="delete"></button>
                        This page allows you to interface with the external <a href="https://spotdl.rtfd.io/" target="_blank">SpotDL</a> application.
                        Please ensure that Python, SpotDL (installed via pip), and FFmpeg are correctly installed and configured on your system's PATH for this functionality to work.
                        JMusic does not manage these external applications; it only provides a user interface to send commands to them.
                    </div>
                    <div id="spotdlWarningMessage" class="notification is-warning is-hidden">
                        <!-- Warning messages will be displayed here -->
                    </div>
                    <div class="box has-background-grey-darker">                        
                        <div class="columns">
                            <div class="column is-two-thirds">
                                <div class="field">
                                    <label class="label has-text-white" for="spotdlUrl">Spotify/YouTube URL</label>
                                    <div class="control">
                                        <input class="input" type="text" id="spotdlUrl" placeholder="Enter Spotify or YouTube URL">
                                    </div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="field">
                                    <label class="label has-text-white" for="outputFormat">Output Format</label>
                                    <div class="control">
                                        <div class="select is-fullwidth">
                                            <select id="outputFormat">
                                                <option value="mp3">MP3</option>
                                                <option value="flac">FLAC</option>
                                                <option value="ogg">OGG</option>
                                                <option value="opus">OPUS</option>
                                                <option value="m4a">M4A</option>
                                                <option value="wav">WAV</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="columns">

                            <div class="column is-half">
                                <div class="field">
                                    <label class="label has-text-white" for="downloadThreads">Download Threads</label>
                                    <div class="control">
                                        <input class="input" type="number" id="downloadThreads" value="4" min="1">
                                    </div>
                                </div>
                            </div>
                            <div class="column is-half">
                                <div class="field">
                                    <label class="label has-text-white" for="searchThreads">Search Threads</label>
                                    <div class="control">
                                        <input class="input" type="number" id="searchThreads" value="4" min="1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label has-text-white" for="downloadFolder">Download Folder</label>
                            <div class="control">
                                <input class="input" type="text" id="downloadFolder" placeholder="e.g., C:\Music\SpotDL">
                            </div>
                        </div>

                        <div class="field">
                            <div class="control">
                                <button class="button is-primary" id="downloadBtn">Download</button>
                            </div>
                        </div>
                        <div class="field mt-4">
                            <label class="label has-text-white">Import Output</label>
                            <div class="control">
                                <textarea class="textarea has-background-black has-text-success" id="spotdlOutput" rows="10" readonly></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="hero-foot card has-background-grey-darker has-text-white m-3 p-3">
                <nav class="level is-mobile">
                    <div class="level-left is-hidden-mobile">
                        <div class="level-item">
                            <div class="image-container mr-3">
                                <figure class="image is-32x32">
                                    <img id="songCoverImage" src="/logo.png" alt="Song Cover">
                                </figure>
                                <button id="expandImageBtn">
                                    <span class="icon is-small"><i class="pi pi-expand"></i></span>
                                </button>
                            </div>
                            <div>
                                <p id="songTitle" class="has-text-white has-text-weight-semibold is-size-6">Loading...</p>
                                <p id="songArtist" class="has-text-success is-size-7">Unknown Artist</p>
                            </div>
                        </div>
                    </div>
                    <div class="level-item has-text-centered is-flex is-flex-direction-column is-align-items-center" style="width: 100%; flex-grow: 1; flex-shrink: 1;">
                        <div class="buttons are-small mb-2">
                            <button id="shuffleBtn" title="Shuffle"><i id="shuffleIcon" class="pi pi-sort-alt"></i></button>
                            <button id="prevBtn"  title="Previous"><i class="pi pi-step-backward"></i></button>
                            <button id="playPauseBtn"  title="Play/Pause"><i id="playPauseIcon" class="pi pi-play"></i></button>
                            <button id="nextBtn"   title="Next"><i class="pi pi-step-forward"></i></button>
                            <button id="repeatBtn"   title="Repeat"><i id="repeatIcon" class="pi pi-refresh"></i></button>
                        </div>
                        <div class="is-flex is-align-items-center is-justify-content-center" style="width: 100%;">
                            <span id="currentTime" class="has-text-success has-text-weight-semibold is-size-6 mr-2">0:00</span>
                            <input type="range" min="0" max="100" value="0"
                                   style="width:100%"
                                   name="seconds" id="playbackProgressBar"/>
                            <span id="totalTime" class="has-text-success has-text-weight-semibold is-size-6 ml-2">0:00</span>
                        </div>
                        <div class="is-hidden-desktop mt-2" style="width: 100%;">
                            <div style="overflow: hidden;">
                                <p id="songTitleMobile" class="has-text-white has-text-weight-semibold is-size-6 marquee">Loading...</p>
                            </div>
                            <div style="overflow: hidden;">
                                <p id="songArtistMobile" class="has-text-success is-size-7 marquee">Unknown Artist</p>
                            </div>
                        </div>
                    </div>
                    <div class="level-right is-hidden-mobile">
                        <div class="level-item">
                            <div class="is-flex is-align-items-center">
                                <i class="pi pi-volume-up has-text-white mr-2"></i>
                                <input type="range" min="0" max="100" value="80" name="level" id="volumeProgressBar"/>
                            </div>
                        </div>
                    </div> 
                </nav>
            </div>
        </section>
        <script src="/js/musicBar.js"></script>
        <script src="/js/playlistBar.js"></script>
        <script src="/js/navbar.js"></script>
        <script src="/js/songQueue.js"></script>
        <script src="/js/import.js"></script>
    </body>
</html>