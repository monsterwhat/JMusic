<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title id="pageTitle">JMusic Settings</title>

        <script src="/js/theme-initializer.js"></script>

        <!-- Bulma CSS -->
        <link rel="stylesheet" href="/css/bulma.min.css"/>
        <link rel="stylesheet" href="https://unpkg.com/primeicons@7.0.0/primeicons.css">
        <link rel="stylesheet" href="/css/custom.css"/>
        <link rel="stylesheet" href="/css/playback-bar.css"/>

        <!-- HTMX -->
        <script src="/js/htmx.min.js"></script>

        <link id="favicon" rel="icon" type="image/x-icon" href="logo.png">

        <style>
            html, body {
                height: 100%;
                background-color: #222;
            }

            body {
                display: flex;
                flex-direction: column;
            }

            .content-wrapper {
                flex-grow: 1;
                overflow: auto;
            }

            #logsPanel::-webkit-scrollbar {
                width: 6px;
            }
            #logsPanel::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 3px;
            }
            #logsPanel::-webkit-scrollbar-thumb:hover {
                background: #aaa;
            }
        </style>
    </head>
    <body>

        <audio id="audioPlayer" preload="metadata"></audio> 

        <section class="hero is-fullheight">

            <!-- Hero Head (Navbar) -->
            <div class="hero-head">
                <nav class="navbar" role="navigation">
                    <div class="navbar-brand">
                        <a class="navbar-item" href="/index.html"><strong>JMusic</strong></a>
                        <a role="button" class="navbar-item" id="themeToggle">
                            <i class="pi pi-sun" id="themeIcon"></i>
                        </a>
                        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                            <span aria-hidden="true"></span>
                            <span aria-hidden="true"></span>
                            <span aria-hidden="true"></span>
                        </a>
                        <a role="button" class="navbar-item is-hidden-desktop is-hidden-mobile" id="sidebarToggle">
                            <i class="pi pi-bars"></i>
                        </a>
                    </div>
                    <div id="navMenu" class="navbar-menu">
                        <div class="navbar-end">
                            <a class="navbar-item" href="/index.html">Home</a> 
                            <a class="navbar-item" href="/settings.html">Settings</a>
                            <a class="navbar-item" href="/import.html">Import</a>
                        </div>
                    </div>
                </nav>
            </div>

            <!-- Hero Body (Main content area) -->
            <div class="hero-body m-0 p-0">
                <div class="columns p-0 m-0" style="width:100%;">
                    <!-- Settings Content -->
                    <div class="content-wrapper" style="height: calc(100vh - 200px);">
                        <section class="section">
                            <div class="container">
                                <h1 class="title has-text-white">Settings</h1>
                                <div class="columns is-multiline">

                                    <!-- Library Management Card -->
                                    <div class="column is-one-third">
                                        <div class="card has-background-grey-darker has-text-white">
                                            <header class="card-header">
                                                <p class="card-header-title has-text-white">
                                                    Library Management
                                                </p>
                                                <button class="card-header-icon" aria-label="more options" id="toggleLibraryManagementBtn">
                                                    <span class="icon">
                                                        <i class="pi pi-angle-down" aria-hidden="true"></i>
                                                    </span>
                                                </button>
                                            </header>
                                            <div class="card-content" id="libraryManagementContent">
                                                <div class="field">
                                                    <label class="label has-text-white">Music Library Folder</label>
                                                    <div class="control has-addons">
                                                        <input id="musicLibraryPathInput" name="musicLibraryPathInput" class="input has-background-grey-darker has-text-white is-expanded" type="text" placeholder="Select music library folder" value="(not set)">
                                                        <button id="browseMusicFolderBtn" class="button is-info">Browse</button>
                                                    </div>
                                                </div>
                                                <div class="buttons mt-3">
                                                    <button id="saveMusicLibraryPathBtn" class="button is-success"
                                                            hx-post="/api/settings/music-library-path"
                                                            hx-include="#musicLibraryPathInput"
                                                            hx-swap="none">Save Path</button>
                                                </div>
                                                <div class="buttons">
                                                    <button id="resetLibrary" class="button is-link">Reset to Default</button>
                                                    <button id="scanLibrary" class="button is-primary">Scan Library</button>
                                                    <button id="reloadMetadata" class="button is-info">Reload All Metadata</button>
                                                    <button id="deleteDuplicates" class="button is-warning">Delete Duplicates</button>
                                                </div>
                                                <div class="field mt-5">
                                                    <label class="switch is-info">
                                                        <input id="runAsServiceToggle" type="checkbox" name="runAsServiceToggle"
                                                               hx-post="/api/settings/toggle-run-as-service"
                                                               hx-trigger="change"
                                                               hx-swap="none">
                                                        <span class="check"></span>
                                                        <span class="control-label has-text-white">Run as Service</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                                                         <!-- Data Management Card -->
                                                                        <div class="column is-one-third">
                                                                            <div class="card has-background-grey-darker has-text-white">
                                                                                <header class="card-header">
                                                                                    <p class="card-header-title has-text-white">
                                                                                        Data Management
                                                                                    </p>
                                                                                    <button class="card-header-icon" aria-label="more options" id="toggleDataManagementBtn">
                                                                                        <span class="icon">
                                                                                            <i class="pi pi-angle-down" aria-hidden="true"></i>
                                                                                        </span>
                                                                                    </button>
                                                                                </header>
                                                                                <div class="card-content" id="dataManagementContent">
                                                                                    <p class="subtitle has-text-white">Manage application data.</p>
                                                                                    <div class="buttons">
                                                                                        <button id="clearSongs" class="button is-warning">Clear Songs DB</button>
                                                                                        <button id="clearPlaybackHistory" hx-post="/api/settings/clearPlaybackHistory" class="button is-danger">Clear Playback History</button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>


                                    
                                    <!-- Logs Card -->
                                    <div class="column is-one-third">
                                        <div class="card has-background-grey-darker has-text-white">
                                            <header class="card-header">
                                                <p class="card-header-title has-text-white">
                                                    Logs
                                                </p>
                                                <button class="card-header-icon" aria-label="more options" id="toggleLogsBtn">
                                                    <span class="icon">
                                                        <i class="pi pi-angle-down" aria-hidden="true"></i>
                                                    </span>
                                                </button>
                                            </header>
                                            <div class="card-content" id="logsCardContent">
                                                <div style="max-height: 200px; overflow-y: auto;" id="logsPanel">
                                                    <!-- JS will populate logs here -->
                                                </div>
                                                <div class="buttons mt-3">
                                                    <button id="clearLogs" class="button is-danger">Clear Logs</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Browse Management Card -->
                                    <div class="column is-one-third">
                                        <div class="card has-background-grey-darker has-text-white">
                                            <header class="card-header">
                                                <p class="card-header-title has-text-white">
                                                    Torrent Management                                                                                    </p>
                                                <button class="card-header-icon" aria-label="more options" id="toggleTorrentManagementBtn">
                                                    <span class="icon">
                                                        <i class="pi pi-angle-down" aria-hidden="true"></i>
                                                    </span>
                                                </button>
                                                <div class="card-header-icon">
                                                    <label class="switch is-info">
                                                        <input id="torrentBrowsingToggle" type="checkbox" name="torrentBrowsingToggle">
                                                        <span class="check"></span>
                                                    </label>
                                                </div>
                                            </header>
                                            <div class="card-content" id="browseManagementContent">
                                                <p class="subtitle has-text-white">Manage browse content.</p>
                                                <div class="field">
                                                    <label class="switch is-info">
                                                        <input id="torrentPeerDiscoveryToggle" type="checkbox" name="torrentPeerDiscoveryToggle">
                                                        <span class="check"></span>
                                                        <span class="control-label has-text-white" onmouseover="this.title='Automatically share torrents with peers.'">Toggle Auto Peer Sharing</span>
                                                    </label>
                                                </div>
                                                <div class="field">
                                                    <label class="switch is-info">
                                                        <input id="torrentDiscoveryToggle" type="checkbox" name="torrentDiscoveryToggle">
                                                        <span class="check"></span>
                                                        <span class="control-label has-text-white" onmouseover="this.title='Automatically discover and share torrents.'">Toggle Auto Torrent Sharing</span>
                                                    </label>
                                                </div>
                                                <div class="buttons mt-3">
                                                    <button id="createUserKey" class="button is-link">Create/Update User Key</button>
                                                    <button id="shareCodeQrCode" class="button is-info">Share Code/QR Code</button>
                                                    <button id="addCodeQrCode" class="button is-success">Add Code/QR Code</button>
                                                    <button id="rescanNetwork" class="button is-warning">Re-scan Network</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </section>
                    </div> 
                </div>
            </div>

            <!-- Hero Foot (Music Bar) -->
            <div class="hero-foot card has-background-grey-darker has-text-white m-3 p-3">
                <nav class="level is-mobile">

                    <!-- LEFT: Song Info -->
                    <div class="level-left is-hidden-mobile">
                        <div class="level-item">
                            <div class="image-container mr-3">
                                <figure class="image is-32x32">
                                    <img id="songCoverImage" src="/logo.png" alt="Song Cover">
                                </figure>
                                <button id="expandImageBtn">
                                    <span class="icon is-small"><i class="pi pi-expand"></i></span>
                                </button>
                            </div>
                            <div>
                                <p id="songTitle" class="has-text-white has-text-weight-semibold is-size-6">Loading...</p>
                                <p id="songArtist" class="has-text-success is-size-7">Unknown Artist</p>
                            </div>
                        </div>
                    </div>

                    <!-- CENTER: Controls + Progress -->
                    <div class="level-item has-text-centered is-flex is-flex-direction-column is-align-items-center" style="width: 100%; flex-grow: 1; flex-shrink: 1;">
                        <!-- Playback buttons -->
                        <div class="buttons are-small mb-2">
                            <button id="shuffleBtn" title="Shuffle"><i id="shuffleIcon" class="pi pi-sort-alt"></i></button>
                            <button id="prevBtn"  title="Previous"><i class="pi pi-step-backward"></i></button>
                            <button id="playPauseBtn"  title="Play/Pause"><i id="playPauseIcon" class="pi pi-play"></i></button>
                            <button id="nextBtn"   title="Next"><i class="pi pi-step-forward"></i></button>
                            <button id="repeatBtn"   title="Repeat"><i id="repeatIcon" class="pi pi-refresh"></i></button>
                        </div>

                        <!-- Progress bar -->
                        <div class="is-flex is-align-items-center is-justify-content-center" style="width: 100%;">
                            <span id="currentTime" class="has-text-success has-text-weight-semibold is-size-6 mr-2">0:00</span>
                            <input type="range" min="0" max="100" value="0"
                                   style="width:100%"
                                   name="seconds" id="playbackProgressBar"/>
                            <span id="totalTime" class="has-text-success has-text-weight-semibold is-size-6 ml-2">0:00</span>
                        </div>

                        <!-- Song Info for mobile -->
                        <div class="is-hidden-desktop mt-2" style="width: 100%;">
                            <div style="overflow: hidden;">
                                <p id="songTitleMobile" class="has-text-white has-text-weight-semibold is-size-6 marquee">Loading...</p>
                            </div>
                            <div style="overflow: hidden;">
                                <p id="songArtistMobile" class="has-text-success is-size-7 marquee">Unknown Artist</p>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT: Volume -->
                    <div class="level-right is-hidden-mobile">
                        <div class="level-item">
                            <div class="is-flex is-align-items-center">
                                <i class="pi pi-volume-up has-text-white mr-2"></i>
                                <input type="range" min="0" max="100" value="80" name="level" id="volumeProgressBar"/>
                            </div>
                        </div>
                    </div> 
                </nav>
            </div>

        </section>

        <script src="/js/musicBar.js"></script>
        <script src="/js/settings.js"></script>
        <script src="/js/navbar.js"></script>

        <!-- Run as Service Info Modal -->
        <div id="runAsServiceModal" class="modal">
            <div class="modal-background"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">Run as Service Information</p>
                    <button class="delete" aria-label="close"></button>
                </header>
                <section class="modal-card-body">
                    <p>Enabling "Run as Service" allows this application to act as a music server, enabling other devices on the network (or with a connection to this device) to stream music from it. When "Run as Service" is enabled, the application will not automatically shut down when all connections close (i.e., no sessions left, either desktop or mobile) but rather will just exist in the background with the tray icon allowing you to close the app manually when desired. Please note that enabling this option does NOT make the application start automatically on system startup; you will still need to launch it manually.</p>
                </section>
                <footer class="modal-card-foot is-flex is-justify-content-center">
                    <button class="button is-success">Got it!</button>
                </footer>
            </div>
        </div>

    </body>
</html>
