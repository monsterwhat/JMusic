<div class='column is-9 is-full-mobile' id='playlistView' data-playlist-id='{playlistId}'>
    <div class='card has-background-grey-darker has-text-white'>
        <header class='card-header'>
            <p id='playlistTitle' class='card-header-title has-text-white is-4'>{playlistName}</p>
            <button
                class='is-small is-rounded has-text-success ml-2'
                hx-post='/api/music/ui/playback/queue-all/{playlistId}'
                hx-trigger='click'
                hx-swap='none'
                data-playlist-id='{playlistId}'>
                <i class='pi pi-play'></i> Play All
            </button>

            <button class='card-header-icon' aria-label='more options' id='toggleAllSongsBtn'>
                <span class='icon'><i class='pi pi-angle-down' aria-hidden='true'></i></span>
            </button>
        </header>
                                            <div class='card-content m-0 p-0' id='allSongsContent'>
                                                <div id='songListContainer' style='max-height: calc(100vh - 320px); overflow-y: auto;'>
                                                    <table id='songTable' class='table is-fullwidth is-hoverable is-striped'>
                                                        <thead>
                                                            <tr><th></th><th>Title / Artist</th><th>Date Added</th><th>Duration</th><th>Action</th></tr>
                                                        </thead>
                                                        <tbody id='songTableBody'
                                                               hx-get='/api/music/ui/tbody/{playlistId}'
                                                               hx-swap='innerHTML'
                                                               hx-indicator="self"
                                                               hx-on::htmx:beforeRequest="this.querySelector('#loadingRow').style.display='table-row'"
                                                               hx-on::htmx:afterRequest="this.querySelector('#loadingRow').style.display='none'">
                                                            <tr id="loadingRow" class="htmx-indicator">
                                                                <td colspan="5" class="has-text-centered py-4">
                                                                    <i class="pi pi-spin pi-spinner" style="font-size: 2rem;"></i>
                                                                    <p>Loading songs...</p>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>    </div>
</div>

<script>
    document.addEventListener('htmx:afterRequest', function (evt) {
        const btn = evt.target.closest('button[data-playlist-id]');
        if (!btn)
            return;

        const playlistId = btn.dataset.playlistId;

        // Update the song queue
        htmx.ajax('GET', '/api/music/ui/queue-fragment', {
            target: document.querySelector('#songQueueTable tbody'),
            swap: 'innerHTML'
        });

        // Update the playlist table
        htmx.ajax('GET', '/api/music/ui/tbody/' + playlistId, {
            target: document.querySelector('#songTable tbody'),
            swap: 'innerHTML'
        });
    });


</script>
